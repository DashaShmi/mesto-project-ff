(()=>{"use strict";function e(e,n,o,r,c){var a=document.getElementById("card-template").content.querySelector(".card").cloneNode(!0);a.dataset.id=e._id;var u=a.querySelector(".card__delete-button");a.querySelector(".card__title").innerText=e.name;var i=a.querySelector(".card__image");i.src=e.link,i.alt="Красоты мира ".concat(e.alt);var s=a.querySelector(".likes__count");s.textContent="".concat(e.likes.length),u.addEventListener("click",(function(){r&&r(a)})),i.addEventListener("click",(function(){o&&o(e)}));var l=a.querySelector(".card__like-button");return l.addEventListener("click",(function(){c&&c(a,l,s)})),e.owner._id!==n&&u.remove(),e.likes.some((function(e){return e._id===n}))&&t(l),a}function t(e){return e.classList.toggle("card__like-button_is-active")}var n={baseUrl:"https://nomoreparties.co/v1/wff-cohort-12",headers:{authorization:"2798e004-6d38-4fe5-b840-9ed182b5c951","Content-Type":"application/json"}};function o(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c)}function r(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",c)}function c(e){"Escape"===e.key&&o(document.querySelector(".popup_is-opened"))}var a=document.querySelector(".popup_type_image"),u=document.querySelector(".popup_type_edit"),i=document.querySelector(".popup_type_new-card"),s=document.querySelector(".popup_type_avatar"),l=document.querySelector(".popup__form[name='edit-profile']"),d=document.querySelector(".popup__form[name='new-place']"),p=document.querySelector(".popup__form[name='edit-avatar']"),f=document.querySelector(".profile__image"),_=document.querySelector(".profile__edit-button"),m=document.querySelector(".popup__input_type_name"),v=document.querySelector(".popup__input_type_description"),y="-",h=document.querySelector(".profile__title"),S=document.querySelector(".profile__description"),b=l.querySelector(".popup__button"),q=d.querySelector(".popup__input_type_card-name"),E=d.querySelector(".popup__button"),k=d.querySelector(".popup__input_type_url"),L=p.querySelector(".popup__input_type_url"),g=p.querySelector(".popup__button"),C=document.querySelector(".places__list");function x(e){r(a),document.querySelector(".popup__image").src=e.link,document.querySelector(".popup__caption").innerText=e.name}_.addEventListener("click",(function(){T(l),r(u),m.value=h.textContent,v.value=S.textContent})),l.addEventListener("submit",(function(e){e.preventDefault(),h.textContent=m.value,S.textContent=v.value;var t,r=b.innerText;b.disabled=!0,b.innerText="Сохранение...",(t={name:m.value,about:v.value},fetch("".concat(n.baseUrl,"/users/me"),{method:"PATCH",headers:n.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){})).catch((function(e){console.log(e)})).finally((function(){o(u),b.disabled=!0,b.innerText=r}))})),document.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",(function(){o(e.closest(".popup"))}))})),document.querySelector(".profile__add-button").addEventListener("click",(function(){T(d),q.value="",k.value="",r(i)})),f.addEventListener("click",(function(){T(p),L.value="",r(s)})),d.addEventListener("submit",(function(t){t.preventDefault();var r,c={name:q.value,link:k.value},a=E.innerText;E.disabled=!0,E.innerText="Сохранение...",(r=c,fetch("".concat(n.baseUrl,"/cards"),{method:"POST",headers:n.headers,body:JSON.stringify(r)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(t){var n=e(t,y,x,A,U);C.prepend(n)})).catch((function(e){console.log(e)})).finally((function(){o(i),q.value="",k.value="",E.disabled=!0,E.innerText=a}))})),p.addEventListener("submit",(function(e){e.preventDefault();var t,r={avatar:L.value},c=g.innerText;g.disabled=!0,g.innerText="Сохранение...",(t=r,fetch("".concat(n.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:n.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){f.style.backgroundImage="url(".concat(e.avatar,")")})).catch((function(e){console.log(e)})).finally((function(){o(s),L.value="",g.disabled=!0,g.innerText=c}))})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup")&&o(e)}))}));var T=function(e){function t(t,n){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),o.classList.remove(e.errorClass),o.textContent="-"}function n(t){t.disabled=!1,t.classList.remove(e.inactiveButtonClass)}return Array.from(document.querySelectorAll(e.formSelector)).forEach((function(o){o.addEventListener("submit",(function(e){e.preventDefault()})),function(o){var r=Array.from(o.querySelectorAll(e.inputSelector));r.forEach((function(c){c.addEventListener("input",(function(){!function(n,o){o.validity.patternMismatch?o.setCustomValidity(o.dataset.errorMessage):o.setCustomValidity(""),o.validity.valid?t(n,o):function(t,n,o){var r=t.querySelector(".".concat(n.id,"-error"));n.classList.add(e.inputErrorClass),r.textContent=o,r.classList.add(e.errorClass)}(n,o,o.validationMessage)}(o,c);var a=o.querySelector(e.submitButtonSelector);!function(t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?n(o):function(t){t.disabled=!0,t.classList.add(e.inactiveButtonClass)}(o)}(r,a)}))}))}(o)})),{clearValidation:function(o){Array.from(o.querySelectorAll(e.inputSelector)).forEach((function(e){t(o,e)})),n(o.querySelector(e.submitButtonSelector))}}}({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active",inactiveButtonClass:"popup__button_inactive"}).clearValidation,j=fetch("".concat(n.baseUrl,"/users/me"),{headers:n.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),P=fetch("".concat(n.baseUrl,"/cards"),{headers:n.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}));function A(e){var t;!function(e){e.remove()}(e),t=e.dataset.id,fetch("".concat(n.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:n.headers})}function U(e,o,r){var c,a=t(o),u=e.dataset.id;c=!0===a?function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:n.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(u):function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:n.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(u),c.then((function(e){r.innerText=e.likes.length})).catch((function(e){console.log(e)}))}Promise.all([j,P]).then((function(t){console.log(t);var n=t[0],o=t[1];h.textContent=n.name,S.textContent=n.about,f.style.backgroundImage="url(".concat(n.avatar,")"),y=n._id,o.forEach((function(t){var n=e(t,y,x,A,U);C.append(n)}))})).catch((function(e){console.log(e)}))})();