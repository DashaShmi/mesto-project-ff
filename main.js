(()=>{"use strict";function e(e,n,o,r,c){var a=document.getElementById("card-template").content.querySelector(".card").cloneNode(!0);a.dataset.id=e._id;var i=a.querySelector(".card__delete-button");a.querySelector(".card__title").innerText=e.name;var u=a.querySelector(".card__image");u.src=e.link,u.alt="Фотография ".concat(e.name);var l=a.querySelector(".likes__count");l.textContent="".concat(e.likes.length),i.addEventListener("click",(function(){r&&r(a)})),u.addEventListener("click",(function(){o&&o(e)}));var s=a.querySelector(".card__like-button");return s.addEventListener("click",(function(){c&&c(a,s,l)})),e.owner._id!==n?i.remove():i.addEventListener("click",(function(){r&&r(a)})),e.likes.some((function(e){return e._id===n}))&&t(s),a}function t(e){return e.classList.toggle("card__like-button_is-active")}var n={baseUrl:"https://nomoreparties.co/v1/wff-cohort-12",headers:{authorization:"2798e004-6d38-4fe5-b840-9ed182b5c951","Content-Type":"application/json"}};function o(e){return e.then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}function r(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a)}function c(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",a)}function a(e){"Escape"===e.key&&r(document.querySelector(".popup_is-opened"))}var i=document.querySelector(".popup_type_image"),u=document.querySelector(".popup_type_edit"),l=document.querySelector(".popup_type_new-card"),s=document.querySelector(".popup_type_avatar"),d=document.querySelector(".popup__form[name='edit-profile']"),p=document.querySelector(".popup__form[name='new-place']"),f=document.querySelector(".popup__form[name='edit-avatar']"),_=document.querySelector(".profile__image"),m=document.querySelector(".profile__edit-button"),v=document.querySelector(".popup__input_type_name"),y=document.querySelector(".popup__input_type_description"),h="-",S=document.querySelector(".profile__title"),b=document.querySelector(".profile__description"),q=d.querySelector(".popup__button"),E=p.querySelector(".popup__input_type_card-name"),L=p.querySelector(".popup__button"),k=p.querySelector(".popup__input_type_url"),g=f.querySelector(".popup__input_type_url"),C=f.querySelector(".popup__button"),x=document.querySelector(".places__list");function T(e){c(i);var t=document.querySelector(".popup__image");t.src=e.link,t.alt="Фотография ".concat(e.name),document.querySelector(".popup__caption").innerText=e.name}m.addEventListener("click",(function(){A(d),c(u),v.value=S.textContent,y.value=b.textContent})),d.addEventListener("submit",(function(e){e.preventDefault();var t,c=q.innerText;q.disabled=!0,q.innerText="Сохранение...",(t={name:v.value,about:y.value},o(fetch("".concat(n.baseUrl,"/users/me"),{method:"PATCH",headers:n.headers,body:JSON.stringify(t)}))).then((function(e){S.textContent=e.name,b.textContent=e.about})).catch((function(e){console.log(e)})).finally((function(){r(u),q.disabled=!0,q.innerText=c}))})),document.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",(function(){r(e.closest(".popup"))}))})),document.querySelector(".profile__add-button").addEventListener("click",(function(){A(p),p.reset(),c(l)})),_.addEventListener("click",(function(){A(f),g.value="",c(s)})),p.addEventListener("submit",(function(t){t.preventDefault();var c,a={name:E.value,link:k.value},i=L.innerText;L.disabled=!0,L.innerText="Сохранение...",(c=a,o(fetch("".concat(n.baseUrl,"/cards"),{method:"POST",headers:n.headers,body:JSON.stringify(c)}))).then((function(t){var n=e(t,h,T,w,D);x.prepend(n)})).catch((function(e){console.log(e)})).finally((function(){r(l),L.disabled=!0,L.innerText=i}))})),f.addEventListener("submit",(function(e){e.preventDefault();var t,c={avatar:g.value},a=C.innerText;C.disabled=!0,C.innerText="Сохранение...",(t=c,o(fetch("".concat(n.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:n.headers,body:JSON.stringify(t)}))).then((function(e){_.style.backgroundImage="url(".concat(e.avatar,")")})).catch((function(e){console.log(e)})).finally((function(){r(s),g.value="",C.disabled=!0,C.innerText=a}))})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup")&&r(e)}))}));var A=function(e){function t(t,n){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),o.classList.remove(e.errorClass),o.textContent="-"}function n(t){t.disabled=!1,t.classList.remove(e.inactiveButtonClass)}return Array.from(document.querySelectorAll(e.formSelector)).forEach((function(o){o.addEventListener("submit",(function(e){e.preventDefault()})),function(o){var r=Array.from(o.querySelectorAll(e.inputSelector));r.forEach((function(c){c.addEventListener("input",(function(){!function(n,o){o.validity.patternMismatch?o.setCustomValidity(o.dataset.errorMessage):o.setCustomValidity(""),o.validity.valid?t(n,o):function(t,n,o){var r=t.querySelector(".".concat(n.id,"-error"));n.classList.add(e.inputErrorClass),r.textContent=o,r.classList.add(e.errorClass)}(n,o,o.validationMessage)}(o,c);var a=o.querySelector(e.submitButtonSelector);!function(t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?n(o):function(t){t.disabled=!0,t.classList.add(e.inactiveButtonClass)}(o)}(r,a)}))}))}(o)})),{clearValidation:function(o){Array.from(o.querySelectorAll(e.inputSelector)).forEach((function(e){t(o,e)})),n(o.querySelector(e.submitButtonSelector))}}}({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active",inactiveButtonClass:"popup__button_inactive"}).clearValidation,U=o(fetch("".concat(n.baseUrl,"/users/me"),{headers:n.headers})),B=o(fetch("".concat(n.baseUrl,"/cards"),{headers:n.headers}));function w(e){var t;(t=e.dataset.id,fetch("".concat(n.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:n.headers})).then((function(){!function(e){e.remove()}(e)})).catch((function(e){console.log(e)}))}function D(e,r,c){var a,i=r.classList.contains("card__like-button_is-active"),u=e.dataset.id;a=i?function(e){return o(fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:n.headers}))}(u):function(e){return o(fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:n.headers}))}(u),a.then((function(e){c.innerText=e.likes.length,t(r)})).catch((function(e){console.log(e)}))}Promise.all([U,B]).then((function(t){var n=t[0],o=t[1];S.textContent=n.name,b.textContent=n.about,_.style.backgroundImage="url(".concat(n.avatar,")"),h=n._id,o.forEach((function(t){var n=e(t,h,T,w,D);x.append(n)}))})).catch((function(e){console.log(e)}))})();